---
layout: post
title: 'Совершенный PLEX: видео, музыка, фильмы'
date: '2016-06-20 00:12:52'
tags:
- Mac
- iOS
---

Просмотр фильмов и прослушивание музыки - важная часть моей жизни, часть семейного досуга. Не являюсь киноманом или меломаном, но создать все условия для удобного использования, считаю, обязательным. 

Попробовав стриминговые сервисы и  локальные DLNA сервера, я остановился на PLEX Media Server.


## Жизнь до PLEX
5 лет назад в моем распоряжении оказалось два медиаплеера Western Digital TV Live (WDTV Live gen 2). Подключив к одному плееру внешний жесткий диск 2.5", можно было поделиться коллекцией для всех остальных устройств в сети. Оба устройства были подключены к роутеру по сети Ethernet, доступ к файлам осуществлялся по протоколу SMB.

Схема с двумя плеерами рабочая, но не есть недостатки:  

1. Регулярные подвисания плееров.  
2. Переиндексация коллекции. Запускается при перезагрузке или подключении диска. Во время индексации блокируется доступ на проигрывание, время индексации занимает продолжительное время.  
3. Неудобное пополнение коллекции. Добавить новый фильм можно двумя способами: отсоединить диск от плеера, подключить к компьютеру или загрузить фильм на сетевой диск.  

Схема с просмотром видео устраивала "на троечку", но предстояло реализовать поддержку домашней коллекции музыки. Задумался о централизации хранилища - переносе всего содержимого на NAS.

Wi-Fi маршрутизатором был выбран MikroTik RB951G-2HnD,  в качестве NAS хранилища - Synology DS215j. Медиаплееры WDTV Live. Стереосистему подключил к сети через Airport Express MC414RS/A по протоколу Airplay.

Synology предлагает доступ к разным сервисам: DLNA-сервер, видео-сервер, аудио-станция, фото-станция и пр. Штатные приложения работают достаточно хорошо, регулярно обновляются, есть iOS клиенты. А внешний вид приложения и взаимодействие с пользователем на любителя. 

Через менеджер пакетов есть возможность установить приложения от сторонних разработчиков. Выбор медиа-серверов небольшой, но среди них есть PLEX Media Server.

PLEX Media Server - очень простой и красивый медиа-сервер, с поддержкой разных коллекций контента: фотографии, фильмы, видео, музыка. 

Сервер PLEX существует для большинства платформ (macOS, Windows, Linux, NAS), но для полноценной работы требуется мощный процессор.

Что мне разонравилось в Synology:  

- для каждого сервиса (музыка, фильмы) требуется отдельное приложение;  
- все штатные приложения значительно отличаются друг от друга;  
- слабый процессор, даже для работы штатных приложений(docker, mail server), которые анонсировали в Synology OS 6.  

Для нормальной работы PLEX на Synology потребуется хорошее устройство, серии Play или Plus. В моем распоряжении была бюджетная модель 215j, с  процессором ARM 700mhz.  Для стриминга файлов (без транскодирования) этого достаточно, но если хочется больше возможностей — необходимо другое железо.

После ограниченного знакомства с PLEX, привычный ритм жизни перестал быть спокойным. Началась подготовка к переходу на более мощное железо.


## Выбор железа для  PLEX Media Server
Последние 7 лет я ограничивался использованием Макбуков, как дома так и на работе. 

По стечению обстоятельств, я поменял работу и начал ездить в офис. Макбук перестал быть нужен, захотелось отказаться от мобильности в пользу большого монитора.

Про покупку и выбор Mac Mini написал отдельную заметку [«Как я отказался от MacBook»](http://pavel.miroshnichen.co/2016/06/17/desktop-first/), для PLEX Media Server я выбрал железо:  

- Intel i7, 4 ядра;  
- RAM 8Гб;  
- Внешний USB 3.0 HDD на 2Тб.  

![](http://pavel.miroshnichen.co/images/2016/06/Screen%20Shot%202016-06-18%20at%2021.01.59.png){: .center-image .responsive-image }

Mac Mini стал домашним компьютером и центром развлечений, сервером и устройством, собравшим в себя всё.


## Создание медиатеки
Для использования PLEX необходимо зарегистрироваться на сайте. Большинство возможностей доступно на бесплатном аккаунте, а за PLEX Pass придется заплатить, но об этом позже.

PLEX позволяет создать медиатеки с разным контентом — фильмы, домашнее видео, музыка, фотографии. Для каждой медиатеки будет выбран определенный способ индексации - сканер. 

Сканер автоматически подгружает обложки для альбомов, постеры к фильмам, имена актеров и исполнителей, скачанные сериалы будут разбиты на сезоны.

Можно упростить задачу сканеру — подготовить каталог с файлами в нужной сортировке. Я предполагаю, что вы бережно относитесь к своей коллекции и уже сделали это, но в любом случае можно обратиться к рекомендациям на сайте PLEX￼.

![](http://pavel.miroshnichen.co/images/2016/06/Screen%20Shot%202016-05-05%20at%209.48.11.png){: .center-image .responsive-image }


## Клиенты для PLEX Media Server
Для PLEX существует множество официальных клиентов под все популярные платформы:  

- мобильные платформы (iOS, Android, Windows Phone),  
- десктопные платформы (macOS, Windows, Linux),   
- SMART-телевизоры,   
- ТВ-приставки (Apple TV 4, Chromecast, Amazon Fire TV, Roku, Android TV, Xbox, PlayStation).  

UI и UX для всех клиентов выполнены по единым правилам, перемещение с одного устройства на другое не вызывает трудностей, а взаимодействие с приложениями в процессе использования приносит удовольствие.


### Официальный клиент для Apple TV4 и хак для Apple TV3 
Для Apple TV4 доступно официальное приложение PLEX в App Store, а для установки на Apple TV3 потребуются некоторые действия.

Среди предустановленных приложений на Apple TV3  нет PLEX, как и нет Jailbreak'а для третьей версии, но есть одна лазейка в приложении "Трейлеры". Весь контент в трейлерах — простая веб страница, которую можно подменить. 

OpenPLEX позволяет сформировать контент для приложения "Трейлеры", сгенерировать сертификаты.

В итоге необходимо прописать DNS на приставке и на открытии «Трейлеров» будет запускаться упрощенный клиент PLEX.

Вернемся к Apple TV 4. Для неё доступна установка официального приложения из App Store.  Apple накладывает ограничения на разработчиков, но клиент работает стабильно, выглядит так же прекрасно, как iOS или веб клиенты.


### PLEX для iOS
Приложение [«PLEX»](https://itunes.apple.com/ru/app/plex/id383457673?mt=8&uo=4&at=1001l9qh&ct=blog) для iOS бесплатное, но включает два типа встроенных покупок (In App Purchase):  

- бессрочная разблокировка проигрывания;  
- активация PLEX Pass на 1 месяц.  

С первым пунктом более-менее все понятно, он снимает 2-х минутное ограничение на проигрывание трека или просмотр фильма. За него нужно заплатить один раз in-app-purchase и забыть. 

Про подписку PLEX Pass я расскажу чуть позже, а сейчас вернемся к  использованию приложения на iOS с разблокированными функциями:

1. Стриминг без ограничений. Если сервер доступен во внешней сети, не обязательно синхронизировать контент на телефоне.
2. Синхронизация контента для проигрывания оффлайн. Самолет или деревня, не важно где, но контент будет доступен без сети.
3. Выгрузка медиатеки (фотографий и видео) на PLEX Media Server.

![](http://pavel.miroshnichen.co/images/2016/06/IMG_0261.PNG){: .center-image .responsive-image }

## Подписка PLEX Pass
Подписка PLEX Pass создана для поддержки развития проекта, разблокировки некоторых дополнительных возможностей. Для большинства сценариев использования можно ограничиться бесплатной версией. 

Вот что дает PLEX Pass:  

1. Доступ к загрузке новых версий PLEX Media Server. На страничке проекта в разделе «Release Notes and Previous Versions» можно посмотреть историю версий, раздачу только PLEX-Pass пользователям или публичный релиз.  
2. Загрузка приложений для SMART-ТВ и прочих устройств. Для меня не актуально.  
3. Трейлеры и дополнительный контент. Трейлеры к фильмам мне не нужны, а вот дополнительный контент — классная функция, когда ты открываешь прослушать альбом и доступны видеоклипы группы.  
4. Синхронизация с мобильными клиентами. Любой контент можно загрузить на телефон или планшет. Если пробросить сервер в «сеть», можно обойтись бесплатным стримингом.  
5. Выгрузка фотографий и видео с мобильного устройства на сервер. Функция удобная, но мне не нравится, как работает просмотр фотографий.  
6. Синхронизация с облаком. Можно выгрузить фильм на Google Drive.  
7. PLEX Home — предоставление доступа к медиатеке другим членам семьи с разделением доступа.  

Полный список доступен на сайте проекта, я ограничился самыми интересными.


## Транскодер PLEX Media Transcoder
Перекодировщик PLEX необходим, когда клиент не может проиграть контент. Например, если загрузить с торрента MKV-файл и попытаться проиграть на Apple TV, то подключится перекодировщик.
  
![](http://pavel.miroshnichen.co/images/2016/06/Screen%20Shot%202016-06-18%20at%2020.23.04.png){: .center-image .responsive-image }

Когда я начинал писать эту заметку, iOS/Apple TV клиенты не умели проигрывать Apple Lossless (ALAC) и подключался перекодировщик. Весь контент и серверная часть были расположены на Synology DS 215j, под нагрузкой конвертации устройство «вешалось». Сейчас, на Mac Mini можно забрасывать любой контент, а актуальные клиенты умеют проигрывать ALAC.  

> ### Сделать моему процессору больно


## Плагины и каналы в PLEX Media Server
PLEX Media Server поддерживает установку плагинов и каналов.

Каналы — доступ к популярным стриминговым сервисам. Многие сервисы не будут интересны, т.к. предназначены для англоязычных пользователей. 
Но если вы пользуетесь сервисами для просмотра сериалов «Soap4Me» или «Kino.Pub», то для них доступны плагины PLEX. Что это дает? Доступ к контенту с любого устройства, единый интерфейс и т.п. Правда реализован доступ через плагины.

Плагины — расширение функциональности PLEX Media Server. Из популярных плагинов можно установить «Кинопоиск», при индексации фильмов будет заполнена информация о фильмах, загружен постер и т.п.

## ⌘
Использую PLEX Media Server 3 месяца и очень доволен. Для локального контента или домашнего видео — лучший медиа сервер. UI и UX приложений проработан и интуитивен, думаю все больше про покупку PLEX Pass Lifetime.
